## 가비지 콜렉터가 동작하는 과정
### 가비지 컬렉션 (GC)
- 자바에서는 유효하지 않은 메모리를 JVM의 가비지 콜렉터가 스스로 정리해준다.  
- 따라서 직접 메모리를 해제할 필요가 없으며, 불필요한 메모리 누수를 막기 위해 가비지 콜렉터의 주기적인 검사를 통해 메모리를 정리한다.  
> System.gc() 메서드를 통해 직접 호출할 수도 있지만, 이는 시스템 성능상 매우 큰 영향을 미치기 때문에 호출해서는 안된다.  

### 객체의 생존 기간에 따른 Heap 영역
- Young  
새로운 객체가 할당되는 영역  
대부분의 객체가 Young 영역에서 생성되었다가 사라진다.
    - 구조
        - Eden 영역(1개) : 새로 생성된 객체가 할당되는 영역
        - Survivor 영역(2개) : GC수행 후 최소 1번 이상 살아남은 객체가 존재하는 영역
- Old  
Young 영역에서 살아남은 Reachable 상태의 객체가 복사되는 영역  
Young 영역보다 크게 할당되고, 가비지는 적게 발생한다.

### 가비지 컬렉션 동작 방식
#### 공통적인 작업 단계
1. Stop the World
    - JVM이 애플리케이션의 실행을 멈추는 단계  
    GC가 실행중일 때는 GC를 실행하는 스레드를 제외한 모든 스레드들의 작업이 중단되고, 완료 후 다시 실행된다. 
2. Mark and Sweep
    - Mark : 사용되는 메모리와 사용되지 않는 메모리를 식별하는 작업 단계
    - Sweep : Mark 단계에서 사용되지 않는 작업으로 식별된 메모리를 해제하는 작업 단계

> 1. Stop the World로 모든 작업을 중단시킨 후, GC는 스택의 모든 변수 또는 Reachable 객체를 스캔하여 어떤 객체를 참고하고 있는지 탐색한다. 
> 2. 사용되고 있는 메모리를 식별하는 Mark 단계를 수행한다. 
> 3. 사용되지 않는 객체들을 메모리에서 제거하는 Sweep 과정을 거친다.

#### Minor GC  
`Young 영역을 대상으로 동작, Eden 영역이 꽉 차면 실행한다.`
1. 새로 생성된 객체가 Young의 Eden 영역에 할당된다.
2. Eden 영역이 꽉 차게 되면 Minor GC가 발생한다.  
    `이 때 사용되지 않는 메모리는 해제되고, Eden 영역의 사용중인 객체는 Survivor 영역으로 옮겨진다. (2개의 Survivor 영역 중 반드시 1개의 영역에만 데이터가 존재해야 한다)`
3. 위 두 과정이 계속해서 반복되어 Survivor 영역이 가득 차게 되면, Survivor 영역의 살아남은 객체를 다른 Survivor영역으로 이동시킨다. 
4. 이 과정을 계속해서 반복 후 살아남은 객체는 Old 영역으로 이동된다.

#### Major GC
`Old 영역을 대상으로 동작, Old 영역이 꽉 차면 실행한다.`  
1. Young 영역에서 살아남은 객체는 Old 영역으로 이동된다.
2. 객체들이 계속해서 이동되어 Old 영역의 메모리가 부족해지면 Major GC가 발생한다.
> Young 영역은 크기가 작기 때문에 Minor GC는 0.5초에서 1초사이에 끝난다.
이에 비해 Old 영역은 크기가 크고, Young 영역을 참조할 수도 있기 때문에 보통 **Minor GC 보다 시간이 오래 걸리며** 10배 이상의 시간을 사용한다.

[참고 자료](https://mangkyu.tistory.com/118)